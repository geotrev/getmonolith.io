!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.undernet=e()}(this,function(){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?c(t):e}var u=16,d=9,h={FOCUSABLE_SELECTOR:":not(.is-visually-hidden)",FOCUSABLE_TAGS:["a","button","input","object","select","textarea","[tabindex]"]},v="keydown",f=function(){function t(){n(this,t),this.handleFocusTrap=this.handleFocusTrap.bind(this)}return a(t,[{key:"getElements",value:function(t){var e=document.querySelectorAll(t);return Array.apply(null,e)}},{key:"getFocusableElements",value:function(e){var n=[];return h.FOCUSABLE_TAGS.map(function(t){return n.push("".concat(e," ").concat(t).concat(h.FOCUSABLE_SELECTOR))}),this.getElements(n.join(", "))}},{key:"captureFocus",value:function(t){this.focusContainer=t;var e=this.getFocusableElements(this.focusContainer);this.focusableFirstChild=e[0],this.focusableLastChild=e[e.length-1],document.addEventListener(v,this.handleFocusTrap)}},{key:"handleFocusTrap",value:function(t){var e=document.activeElement,n=e===document.querySelector(this.focusContainer),o=e===this.focusableFirstChild,a=e===this.focusableLastChild,i=t.which===d,s=t.which===u||t.shiftKey,r=s&&i,c=!s&&i;this.releaseFocus(),this.captureFocus(this.focusContainer),r&&(o||n)?(t.preventDefault(),this.focusableLastChild.focus()):c&&a&&(t.preventDefault(),this.focusableFirstChild.focus())}},{key:"releaseFocus",value:function(){document.removeEventListener(v,this.handleFocusTrap)}}]),t}(),m=27,g="data-modal",b="data-modal-id",y="data-modal-button",A="no-scroll",p="data-visible",C="data-close",E="data-target",S="aria-hidden",k="aria-modal",B="role",O="keydown",w="click",L="Your button is missing its corresponding modal. Check to make sure your modal is in the DOM, and that it has a [data-modal-id=*] attribute matchin its [data-modal-button] and [data-target] attributes. It's possible the modal script ran before the button appeared on the page!",t=function(t){function e(){var t;return n(this,e),(t=l(this,s(e).call(this))).modalContainerAttr="[".concat(g,"]"),t.closeButtonAttr="[".concat(g,"] [").concat(C,"]"),t.modals=null,t.modalButtons=null,t.closeButtons=null,t.bodyTag=document.body,t.htmlTag=document.querySelector("html"),t.getModal=t.getModal.bind(c(c(t))),t.handleModalClose=t.handleModalClose.bind(c(c(t))),t.handleEscapeKeyPress=t.handleEscapeKeyPress.bind(c(c(t))),t.handleOverlayClick=t.handleOverlayClick.bind(c(c(t))),t}return i(e,f),a(e,[{key:"start",value:function(){var e=this;this.modals=this.getElements(this.modalContainerAttr),this.modalButtons=this.getElements("[".concat(y,"]")),this.closeButtons=this.getElements(this.closeButtonAttr),this.modals.length&&this.modals.forEach(function(t){t.setAttribute(k,"true"),t.parentNode.setAttribute(S,"true"),t.parentNode.setAttribute(p,"false"),t.setAttribute(B,"dialog")}),this.modalButtons.length&&this.modalButtons.forEach(function(t){t.addEventListener(w,e.getModal)})}},{key:"stop",value:function(){var e=this;this.modalButtons.forEach(function(t){t.removeEventListener(w,e.getModal)})}},{key:"getModal",value:function(t){t.preventDefault(),this.renderModal(t)}},{key:"renderModal",value:function(t){var e=this;if(this.modalButton=t.target,this.activeModalId=this.modalButton.getAttribute(E),this.modalOverlayAttr="[".concat(b,"='").concat(this.activeModalId,"']"),this.modalOverlay=document.querySelector(this.modalOverlayAttr),!this.modalOverlay)throw L;this.activeModalSelector="".concat(this.modalOverlayAttr," ").concat(this.modalContainerAttr),this.activeModal=document.querySelector(this.activeModalSelector),this.modalCloseButtons=this.getElements("".concat(this.modalOverlayAttr," ").concat(this.closeButtonAttr)),this.handleScrollStop(),this.captureFocus(this.activeModalSelector),this.modalOverlay.setAttribute(S,"false"),this.activeModal.setAttribute("tabindex","-1"),this.modalOverlay.setAttribute(p,"true"),this.activeModal.focus(),this.modalOverlay.scrollTop=0,document.addEventListener(O,this.handleEscapeKeyPress),document.addEventListener(w,this.handleOverlayClick),this.modalCloseButtons.forEach(function(t){t.addEventListener(w,e.handleModalClose)})}},{key:"handleModalClose",value:function(t){var e=this;t.preventDefault(),this.modalOverlay.setAttribute(p,"false"),this.handleReturnFocus(),this.handleScrollRestore(),this.releaseFocus(),this.modalOverlay.setAttribute(S,"true"),this.activeModal.removeAttribute("tabindex"),document.removeEventListener(O,this.handleEscapeKeyPress),document.removeEventListener(w,this.handleOverlayClick),this.modalCloseButtons.forEach(function(t){t.removeEventListener(w,e.handleModalClose)})}},{key:"handleOverlayClick",value:function(t){t.target===this.modalOverlay&&this.handleModalClose(t)}},{key:"handleEscapeKeyPress",value:function(t){t.which===m&&this.handleModalClose(t)}},{key:"handleReturnFocus",value:function(){this.modalButton.setAttribute("tabindex","-1"),this.modalButton.focus(),this.modalButton.removeAttribute("tabindex")}},{key:"handleScrollRestore",value:function(){this.bodyTag.classList.remove(A),this.htmlTag.classList.remove(A)}},{key:"handleScrollStop",value:function(){this.bodyTag.classList.add(A),this.htmlTag.classList.add(A)}}]),e}(),M=32,x="data-accordion",F="data-accordion-row",T="data-expanded",R="data-target",P="data-content",I="data-toggle-multiple",_="data-parent",K="aria-expanded",j="aria-controls",q="aria-hidden",H="click",D="keydown",U="You have an accordion button that is missing its [data-content] attribute, and has a matching id to the button's [data-target] attribute's value.",e=function(t){function e(){var t;return n(this,e),(t=l(this,s(e).call(this))).accordionButtons=null,t.accordionContents=null,t.activeContainer=null,t.renderAccordionContent=t.renderAccordionContent.bind(c(c(t))),t.handleSpaceKeyPress=t.handleSpaceKeyPress.bind(c(c(t))),t}return i(e,f),a(e,[{key:"start",value:function(){var o=this;this.accordionButtons=this.getElements("[".concat(x,"] [").concat(R,"]")),this.accordionContents=this.getElements("[".concat(x,"] [").concat(P,"]")),this.accordionButtons.length&&this.accordionButtons.forEach(function(t){o.setupButton(t),t.addEventListener(H,o.renderAccordionContent),t.addEventListener(D,o.handleSpaceKeyPress)}),this.accordionContents.length&&this.accordionContents.forEach(function(t){var e=o.getAccordionRowAttr(t.id),n="true"===document.querySelector(e).getAttribute(T)?"false":"true";t.setAttribute(q,n)})}},{key:"stop",value:function(){var e=this;this.accordionButtons.forEach(function(t){t.removeEventListener(H,e.renderAccordionContent),t.removeEventListener(D,e.handleSpaceKeyPress)})}},{key:"setupButton",value:function(t){var e=t.getAttribute(R),n=this.getAccordionRowAttr(e),o=document.querySelector(n).getAttribute(T),a=document.getElementById(e);t.setAttribute(j,e),"true"===o?(a.style.maxHeight="".concat(a.scrollHeight,"px"),t.setAttribute(K,"true")):t.setAttribute(K,"false")}},{key:"getAccordionRowAttr",value:function(t){return"[".concat(F,"='").concat(t,"']")}},{key:"renderAccordionContent",value:function(t){t.preventDefault(),this.activeButton=t.target;var e=this.activeButton.getAttribute(R);if(this.activeRowAttr=this.getAccordionRowAttr(e),this.activeRow=document.querySelector(this.activeRowAttr),this.activeContainerId=this.activeButton.getAttribute(_),this.activeContainerAttr="[".concat(x,"='").concat(this.activeContainerId,"']"),this.activeContainer=document.querySelector(this.activeContainerAttr),this.activeContent=document.getElementById(e),!this.activeContent.hasAttribute(P))throw U;var n=this.activeRow.getAttribute(T),o=this.activeContent.getAttribute(P);this.toggleExpandState="true"===n?"false":"true",this.toggleContentState="visible"===o?"hidden":"visible",this.toggleHiddenState="false"===this.toggleExpandState?"true":"false",this.closeAllIfToggleable(),this.toggleSelectedAccordion()}},{key:"handleSpaceKeyPress",value:function(t){t.which===M&&this.renderAccordionContent(t)}},{key:"closeAllIfToggleable",value:function(){var e=this;if(!this.activeContainer.hasAttribute(I)){var t=this.getElements("".concat(this.activeContainerAttr," [").concat(T,"]")),n=this.getElements("".concat(this.activeContainerAttr," [").concat(P,"]")),o=this.getElements("".concat(this.activeContainerAttr," [").concat(R,"]"));n.forEach(function(t){t!==e.activeContent&&(t.style.maxHeight=null)}),this.toggleAttributeInCollection(t,T,"true","false"),this.toggleAttributeInCollection(o,K,"true","false"),this.toggleAttributeInCollection(n,q,"false","true"),this.toggleAttributeInCollection(n,P,"visible","hidden")}}},{key:"toggleSelectedAccordion",value:function(){this.activeRow.setAttribute(T,this.toggleExpandState),this.activeContent.setAttribute(P,this.toggleContentState),this.activeButton.setAttribute(K,this.toggleExpandState),this.activeContent.setAttribute(q,this.toggleHiddenState),this.activeContent.style.maxHeight?this.activeContent.style.maxHeight=null:this.activeContent.style.maxHeight="".concat(this.activeContent.scrollHeight,"px")}},{key:"toggleAttributeInCollection",value:function(t,e,n,o){t.forEach(function(t){t.hasAttribute(e,n)&&t.setAttribute(e,o)})}}]),e}(),Undernet={Modals:new t,Accordions:new e,start:function(){Undernet.Modals.start(),Undernet.Accordions.start()},stop:function(){Undernet.Modals.stop(),Undernet.Accordions.stop()}};return window.Undernet=Undernet});
//# sourceMappingURL=undernet.bundle.min.js.map
